<!doctype html>
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <title id="pageTitle">Loading Trailer & Details...</title> 
  <meta name="description" id="metaDescription" content="Watch trailer and details for the latest series and movies." />
  <meta name="keywords" id="metaKeywords" content="trailer, watch, movie, series, hd" />
  
  <meta property="og:site_name" content="Dareloom Hub">
  <meta property="og:type" content="video.other">
  <meta property="og:title" id="ogTitle" content="Loading Trailer...">
  <meta property="og:description" id="ogDescription" content="">
  <meta property="og:url" id="ogUrl" content="">
  <meta property="og:image" id="ogImage" content="">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" id="twitterTitle" content="Loading Trailer...">
  <meta name="twitter:description" id="twitterDescription" content="">
  <meta name="twitter:image" id="twitterImage" content="">

  <link rel="canonical" id="canonicalUrl" href="https://dareloom.fun/trailer.html">

  <script type="application/ld+json" id="schemaMarkup">{}</script>

  <link rel="stylesheet" href="/style.css?v=20251021" />  
  <style>
    /* Inline styles for trailer.html specific layout */
    :root {
      --primary-color: #ff4b91;
      --secondary-color: #1e90ff;
      --bg-color: #000;
      --card-bg: #111;
      --text-color: #fff;
    }
    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
    }
    .wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Video Player Aspect Ratio for 16:9 */
    .video-player-container {
      position: relative;
      width: 100%; 
      padding-top: 56.25%; 
      height: 0; 
      background: #000;
      margin-bottom: 20px;
      overflow: hidden; 
    }
    
    .video-player-container iframe, 
    .video-player-container div#playerEmbed {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      display: flex; 
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    /* Buttons Layout */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
      justify-content: center;
    }
    .action-buttons button, .action-buttons a {
      flex: 1 1 200px;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 1rem;
    }
    /* Button Colors */
    #watchButton {
      background: var(--primary-color);
      color: #fff;
    }
    /* Dynamic Info Styles */
    .meta-detail {
        margin: 10px 0;
        font-size: 1.1rem;
    }
    .meta-detail strong {
        color: var(--primary-color);
    }
    #description {
      color: #aaa;
      margin-top: 10px;
    }
    #tagsContainer {
      margin-top: 15px;
    }
    .tag-btn {
        background: #333;
        color: #aaa;
        border: none;
        padding: 5px 10px;
        margin-right: 5px;
        margin-bottom: 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        display: inline-block;
    }
    /* Mobile adjustments */
    @media (max-width: 600px) {
        .action-buttons button, .action-buttons a {
            flex: 1 1 100%; /* Stack buttons on small screens */
        }
    }
  </style>
</head>  

<body>  
    <div class="wrap">
        <a href="/" style="display:inline-block; margin-bottom:10px; color:var(--secondary-color);">‚Üê Back to Homepage</a>
        
        <h1 id="videoTitle">Loading...</h1>
        
        <div id="metaInfo" style="margin-bottom: 20px;">
            <p class="meta-detail" id="studioInfo"></p>
            <p class="meta-detail" id="castInfo"></p>
            <p class="meta-detail" id="yearInfo"></p>
        </div>
        
        <div class="video-player-container">
            <div id="playerEmbed">
                </div>
        </div>

        <div class="action-buttons">
            </div>

        <h2>Description</h2>
        <p id="description">Loading description...</p>
        
        <h2>Tags & Categories</h2>
        <div id="tagsContainer"></div>

    </div>

    <script>
        // --- Helper Functions ---
        const qs = sel => document.querySelector(sel);
        
        function getParam(name) {
            return new URLSearchParams(window.location.search).get(name);
        }
        
        function escapeHtml(s){
            return (s||'').toString()
                .replace(/&/g,'&amp;')
                .replace(/</g,'&lt;')
                .replace(/>/g,'&gt;')
                .replace(/"/g,'&quot;')
                .replace(/'/g,'&#39;');
        }
        
        function slugify(text){
            return (text||'').toString().toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
        }

        function extractYouTubeID(url) {
            if (!url) return null;
            const m = url.match(/(?:v=|youtu.be\/|shorts\/|embed\/)([0-9A-Za-z_-]{11})/);
            return m ? m[1] : null;
        }

        function makeThumbnail(it){
            if (it.poster && it.poster.trim()) return it.poster.trim();
            const y = extractYouTubeID(it.trailer || it.watch);
            if (y) return `https://img.youtube.com/vi/${y}/hqdefault.jpg`; 
            return 'https://placehold.co/600x400?text=Dareloom+Hub';
        }
        
        function toEmbedUrl(url){
            if (!url) return '';
            url = url.trim();
            const y = extractYouTubeID(url);
            
            if (y) return `https://www.youtube.com/embed/${y}?autoplay=0&rel=0`; 
            
            if (url.includes('streamtape.com') && url.includes('/v/')){
                const id = url.split('/v/')[1]?.split('/')[0];
                if (id) return `https://streamtape.com/e/${id}/`;
            }
            
            if (url.startsWith('http')) return url;
            
            return '';
        }
        
        // üöÄ UPDATED: Now passes Title and Tags to the ad-gate (/go.html)
        function openWatchPage(targetUrl, title, tags){
            if (!targetUrl) return;
            // title and tags are already URI-encoded when called from the button.
            const redirectPage = `/go.html?target=${encodeURIComponent(targetUrl)}&title=${title}&tags=${tags}`;  
            window.location.href = redirectPage; 
        }

        function renderTagsForItem(it){
            const parts = [];
            if (it.studio) {
                parts.push({ name: it.studio, type: 'studio' });
            }
            if (it.cast) {
                it.cast.split(',').map(p => p.trim()).filter(Boolean).forEach(c => 
                    parts.push({ name: c, type: 'cast' })
                );
            }
            if (it.category) {
                it.category.split(',').map(p => p.trim()).filter(Boolean).forEach(c => 
                    parts.push({ name: c, type: 'category' })
                );
            }

            const uniqueParts = [...new Map(parts.map(item => [item.name, item])).values()];

            return uniqueParts.map(p => {
                const filterUrl = `/?filter=${slugify(p.name)}`;
                return `<a href="${filterUrl}" class="tag-btn">${escapeHtml(p.name)}</a>`;
            }).join(' ');
        }
        
        function setMetaTags(item) {
            const title = item.title || 'Untitled Video';
            const desc = item.description.substring(0, 150) + '...' || 'Watch the trailer and details for this exclusive video.';
            const thumb = makeThumbnail(item);
            const url = window.location.href.split('?')[0] + '?id=' + encodeURIComponent(item.id);

            // 1. Core Tags
            qs('#pageTitle').textContent = `${title} | Watch Trailer & Details`;
            qs('#metaDescription').setAttribute('content', desc);
            
            const keywords = [title, item.studio, item.cast, item.category, 'trailer', 'watch online'].filter(Boolean).join(', ').substring(0, 200);
            qs('#metaKeywords').setAttribute('content', keywords);
            qs('#canonicalUrl').setAttribute('href', url);

            // 2. Open Graph / Twitter Tags
            qs('#ogTitle').setAttribute('content', title);
            qs('#ogDescription').setAttribute('content', desc);
            qs('#ogUrl').setAttribute('content', url);
            qs('#ogImage').setAttribute('content', thumb);

            qs('#twitterTitle').setAttribute('content', title);
            qs('#twitterDescription').setAttribute('content', desc);
            qs('#twitterImage').setAttribute('content', thumb);
        }

        function createVideoSchema(item) {
            const datePublished = item.date ? new Date(item.date).toISOString() : new Date().toISOString();
            const embedUrl = item.trailer ? toEmbedUrl(item.trailer) : '';

            const schema = {
                "@context": "https://schema.org",
                "@type": "VideoObject",
                "name": item.title,
                "description": item.description,
                "thumbnailUrl": makeThumbnail(item),
                "uploadDate": datePublished,
                "contentUrl": embedUrl || item.watch, 
                "embedUrl": embedUrl,
                "duration": "PT0M0S", 
                "publisher": {
                    "@type": "Organization",
                    "name": "Dareloom Hub",
                    "logo": {
                        "@type": "ImageObject",
                        "url": "https://dareloom.fun/web-app-manifest-512x512.png" 
                    }
                }
            };
            
            if (item.cast) {
                schema.actor = item.cast.split(',').map(name => ({
                    "@type": "Person",
                    "name": name.trim()
                }));
            }

            qs('#schemaMarkup').textContent = JSON.stringify(schema, null, 2);
        }


        // --- Main Trailer Page Logic ---
        async function loadTrailerPage() {
            const id = getParam('id');
            const allItems = JSON.parse(localStorage.getItem('dareloom_items') || '[]');
            const item = allItems.find(i => i.id === id);

            if (!id || !item) {
                const defaultTitle = 'Error: Video details not found.';
                qs('#videoTitle').textContent = defaultTitle;
                qs('#description').textContent = 'Please return to the homepage and select a video. (Data may be loading or cache cleared.)';
                qs('#pageTitle').textContent = defaultTitle;
                return;
            }

            // 1. SEO Setup
            setMetaTags(item);
            createVideoSchema(item);
            
            // 2. Set details
            qs('#videoTitle').textContent = item.title;
            qs('#description').textContent = item.description || 'No description available.';

            // 3. Render Studio, Cast, Year
            if (item.studio) qs('#studioInfo').innerHTML = `<strong>Studio:</strong> <a href="/?filter=${slugify(item.studio)}" style="color:#fff;">${item.studio}</a>`;
            if (item.cast) qs('#castInfo').innerHTML = `<strong>Cast:</strong> ${item.cast}`;
            if (item.year) qs('#yearInfo').innerHTML = `<strong>Year:</strong> ${item.year}`;

            // 4. Embed Player
            const embedUrl = toEmbedUrl(item.trailer || item.watch);
            
            if (embedUrl) {
                qs('#playerEmbed').innerHTML = `
                    <iframe src="${embedUrl}" 
                            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                `;
            } else {
                qs('#playerEmbed').innerHTML = '<div style="color: #fff; font-weight: bold; font-size: 1.1rem; padding: 20px;">Trailer/Video cannot be embedded here. Please use the "Open Player" button below.</div>';
            }

            // 5. Render Buttons (Updated to send Title and Tags)
            const buttonsContainer = qs('.action-buttons');
            buttonsContainer.innerHTML = ''; 
            
            // Encode Title and Tags for URL safety before putting them into the onclick string
            const encodedTitle = encodeURIComponent(item.title);
            const encodedTags = encodeURIComponent(item.category || '');

            if (item.watch) {
                // Now passing watch URL, encoded title, and encoded tags
                buttonsContainer.innerHTML += `<button id="watchButton" onclick="openWatchPage('${escapeHtml(item.watch)}', '${encodedTitle}', '${encodedTags}')">Open Full Player</button>`;
            }
            if (item.telegram) {
                 buttonsContainer.innerHTML += `<a id="telegramButton" href="${escapeHtml(item.telegram)}" target="_blank" rel="noopener noreferrer">Telegram Link</a>`;
            }
            
            if (!item.watch && !item.telegram) {
                buttonsContainer.innerHTML = '<p style="text-align:center; width:100%; color:#aaa;">No watch or direct link available for this title.</p>';
            }

            // 6. Render Tags
            qs('#tagsContainer').innerHTML = renderTagsForItem(item);
        }

        // Start the loader
        loadTrailerPage();
    </script>
</body>
</html>
