<!doctype html>
<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <title id="pageTitle">Trailer & Watch Details</title>  
  <link rel="stylesheet" href="/style.css?v=20251020" />  
  <style>
    /* Inline styles for trailer.html specific layout */
    :root {
      --primary-color: #ff4b91;
      --secondary-color: #1e90ff;
      --bg-color: #000;
      --card-bg: #111;
      --text-color: #fff;
    }
    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
    }
    .wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .video-player-container {
      aspect-ratio: 16/9;
      background: #333;
      margin-bottom: 20px;
      position: relative;
    }
    .video-player-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    /* Buttons Layout */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
      justify-content: center;
    }
    .action-buttons button, .action-buttons a {
      flex: 1 1 200px;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 1rem;
    }
    /* Button Colors */
    #watchButton {
      background: var(--primary-color);
      color: #fff;
    }
    #streamtapeButton {
      background: #0088ff; 
      color: #fff;
    }
    #telegramButton {
      background: #2aabee; 
      color: #fff;
    }
    #description {
      color: #aaa;
      margin-top: 10px;
    }
    #tagsContainer {
      margin-top: 15px;
    }
    .tag-btn {
        background: #333;
        color: #aaa;
        border: none;
        padding: 5px 10px;
        margin-right: 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        display: inline-block;
    }
  </style>
</head>  

<body>  
    <div class="wrap">
        <h1 id="videoTitle">Loading...</h1>
        <div class="video-player-container">
            <div id="playerEmbed">
                </div>
        </div>

        <div class="action-buttons">
            </div>

        <h2>Description and Tags</h2>
        <p id="description">Loading description...</p>
        <div id="tagsContainer"></div>

        <a href="/" style="display:block; text-align:center; margin-top:30px; color:var(--secondary-color);">‚Üê Back to Homepage</a>
    </div>

    <script>
        // --- Helper Functions (Copied from script.js) ---
        const qs = sel => document.querySelector(sel);
        function getParam(name) {
            return new URLSearchParams(window.location.search).get(name);
        }
        function extractYouTubeID(url) {
            if (!url) return null;
            const m = url.match(/(?:v=|youtu.be\/|shorts\/|embed\/)([0-9A-Za-z_-]{11})/);
            return m ? m[1] : null;
        }
        function toEmbedUrl(url){
            if (!url) return '';
            url = url.trim();
            const y = extractYouTubeID(url);
            // Autoplay is sometimes blocked, but this is the trailer page (not reels)
            if (y) return `https://www.youtube.com/embed/${y}?autoplay=0&rel=0`; 
            if (url.includes('streamtape.com') && url.includes('/v/')){
                const id = url.split('/v/')[1]?.split('/')[0];
                if (id) return `https://streamtape.com/e/${id}/`;
            }
            if (url.startsWith('http')) return url;
            return '';
        }
        // Use the openWatchPage function from script.js to ensure ad-gate logic is followed
        function openWatchPage(targetUrl){
            if (!targetUrl) return;
            let final = targetUrl;
            if (final.includes('/v/')){
                const m = final.match(/\/v\/([0-9A-Za-z_-]+)/);
                if (m && m[1]) final = `https://streamtape.com/e/${m[1]}/`;
            }
            const redirectPage = `/go.html?target=${encodeURIComponent(final)}`;  
            window.open(redirectPage, '_blank'); 
        }
        function renderTagsForItem(it){
            if (!it.category || !it.category.trim()) return '';
            const parts = it.category.split(',').map(p => p.trim()).filter(Boolean);
            // Tags are rendered as simple buttons/spans here for static display
            return parts.map(p => `<span class="tag-btn" data-tag="${p}">#${p}</span>`).join(' ');
        }

        // --- Main Trailer Page Logic ---
        async function loadTrailerPage() {
            const id = getParam('id');
            // üõë Load data saved by script.js from the homepage
            const allItems = JSON.parse(localStorage.getItem('dareloom_items') || '[]');
            const item = allItems.find(i => i.id === id);

            if (!id || !item) {
                qs('#videoTitle').textContent = 'Error: Video details not found.';
                qs('#description').textContent = 'Please make sure you access this page from the homepage.';
                return;
            }

            // 1. Set details
            document.title = item.title + " | Details";
            qs('#videoTitle').textContent = item.title;
            
            // 2. Set Description (Show fallback if empty)
            qs('#description').textContent = item.description || 'No description available.';

            // 3. Embed Player: Prioritize Trailer, then Watch Link
            const embedUrl = toEmbedUrl(item.trailer || item.watch);
            if (embedUrl) {
                qs('#playerEmbed').innerHTML = `
                    <iframe src="${embedUrl}" 
                            allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                `;
            } else {
                 // üõë Trailer ni chl rha h aagr discription nhi h n show kre trailer
                qs('#playerEmbed').innerHTML = '<div style="padding: 20px; text-align: center; color: #ff4b91; font-weight: bold;">Trailer/Video cannot be embedded here. Use the "Open Player" button below.</div>';
            }

            // 4. Render Buttons
            const buttonsContainer = qs('.action-buttons');
            buttonsContainer.innerHTML = '';
            
            // üõë 1. Open Player Button (Uses the ad-gate logic)
            if (item.watch) {
                buttonsContainer.innerHTML += `<button id="watchButton" onclick="openWatchPage('${item.watch}')">Open Player</button>`;
            }

            // üõë 2. Open Streamtape Button (If streamtape is the watch link)
            if (item.watch.includes('streamtape.com') || item.watch.includes('/e/') || item.watch.includes('/v/')) {
                 // Use direct link for Streamtape button
                 buttonsContainer.innerHTML += `<a href="${item.watch}" target="_blank" id="streamtapeButton">Open Streamtape</a>`;
            }

            // üõë 3. Download Telegram Button
            if (item.telegram) {
                buttonsContainer.innerHTML += `<a href="${item.telegram}" target="_blank" id="telegramButton">Download Telegram</a>`;
            }
            
            // Fallback message if no links are present
            if (!item.watch && !item.telegram) {
                buttonsContainer.innerHTML = '<p style="text-align:center; width:100%; color:#aaa;">No watch or download links available for this title.</p>';
            }

            // 5. Render Tags
            // üõë Tags should also be visible
            qs('#tagsContainer').innerHTML = renderTagsForItem(item);
        }

        // Start the loader
        loadTrailerPage();
    </script>
</body>
</html>
