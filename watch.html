<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Now Watching - Dareloom Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary: #ff4b91;
    --secondary: #1e90ff;
    --background: #0d0d0d;
    --card-bg: #1a1a1a;
    --text-color: #fff;
    --muted-color: #aaa;
}
body,html{
  margin:0;padding:0;height:100%;
  background:var(--background);color:var(--text-color);
  font-family: 'Poppins', sans-serif;
  display:flex;flex-direction:column;align-items:center;
}
header{
  background:var(--card-bg);padding:15px 0;text-align:center;
  font-size:24px;font-weight:700;width:100%;
  box-shadow:0 3px 8px rgba(0,0,0,0.6);
  z-index:10;
}

/* Video Player Styling */
#videoWrap {
  width:100%;
  max-width:900px;
  margin-top:15px;
  position:relative;
  padding-top:56.25%;
  height:0;
  background:#000;
  border-radius:10px;
  overflow:hidden;
}
iframe{
  position:absolute;
  top:0;left:0;width:100%;height:100%;
  border:none;
  z-index:1;
  touch-action:manipulation; /* üß© Fix: Touch responsive */
  pointer-events:auto;       /* üß© Fix: Clicks and fullscreen work */
}
.ad-box{
  margin:15px 0;
  width:100%;text-align:center;
}
.btn{
  background:var(--primary);color:#fff;border:none;
  padding:12px 25px;border-radius:25px;
  cursor:pointer;font-weight:600;
  margin:10px 8px;transition:all 0.3s ease;
  flex-grow:1;max-width:250px;font-size:1rem;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
}
.btn:hover {
  background:#c2185b;transform:translateY(-2px);
  box-shadow:0 6px 12px rgba(0,0,0,0.4);
}
footer{text-align:center;padding:15px;color:var(--muted-color);font-size:0.9rem;}
#adblock-warning-overlay {
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.95);color:white;text-align:center;z-index:99999;
  backdrop-filter:blur(5px);justify-content:center;align-items:center;flex-direction:column;padding:20px;
}
#main-content-wrapper {
  display:none;flex-direction:column;align-items:center;width:95%;max-width:900px;flex-grow:1;
}
#user-message {
  background:var(--card-bg);color:var(--primary);
  padding:15px 20px;border-radius:10px;width:100%;margin-top:20px;text-align:center;
  font-size:17px;font-weight:600;box-shadow:0 2px 4px rgba(0,0,0,0.5);
}
#controls-container {
  display:flex;justify-content:center;width:100%;flex-wrap:wrap;
  margin-top:20px;margin-bottom:20px;padding:10px;background:var(--card-bg);
  border-radius:10px;z-index:2;
}
</style>
</head>
<body>
<header>üé• Dareloom Hub</header>

<div id="adblock-warning-overlay">
  <h1 style="color:#FFD700; font-size:2.2rem;margin-top:0;">üö´ Ad Blocker Detected!</h1>
  <p style="font-size:18px;margin-top:20px;max-width:600px;">
    Humein maaf kijiye, hum aapko video nahi dikha sakte jab tak aap apna **Ad Blocker** disable nahi karte.<br>
    Kripya Ad Blocker band karein aur page ko **refresh** karein.
  </p>
</div>

<div id="main-content-wrapper">
  <div id="user-message">üéâ **Enjoy watching!** Video loading...</div>
  <div id="videoWrap"></div>

  <div id="controls-container"></div>
</div>

<footer>¬© Dareloom Hub</footer>

<script>
// ------------------------- Helper: Get Video Type --------------------------
function getVideoDetails(url){
  url = url.trim();
  if(!url.startsWith('http')) return null;
  const u = url.toLowerCase();

  if(u.includes('streamwish.com') || u.includes('sw.fun')){
    return { type: 'streamwish', label: 'Open Streamwish', color: '#ff6347', isEmbed: true, embedUrl: url.includes('/e/') ? url : url };
  }
  if(u.includes('mixdrop.co') || u.includes('mixdrop.ag')){
    return { type: 'mixdrop', label: 'Open Mixdrop', color: '#6a0dad', isEmbed: true, embedUrl: url.includes('/e/') ? url : url };
  }
  if(u.includes('streamtape.com') || u.includes('/v/')){
    let id = (url.match(/\/v\/([\w-]+)/) || [])[1];
    let embedUrl = id ? `https://streamtape.com/e/${id}/` : url;
    return { type: 'streamtape', label: 'Open Streamtape', color: '#0088ff', isEmbed: true, embedUrl };
  }
  if(u.includes('t.me') || u.includes('telegram.me')){
    return { type: 'telegram', label: 'Open Telegram', color: '#2aabee', isEmbed: false, embedUrl: null };
  }
  return { type: 'other', label: 'Open Link', color: '#e91e63', isEmbed: true, embedUrl: url };
}

// ------------------------- Main Load Function --------------------------
async function loadVideo(){
  const params = new URLSearchParams(window.location.search);
  let raw = params.get("url");
  const videoWrap = document.getElementById("videoWrap");
  const controls = document.getElementById("controls-container");

  if(!raw){
    videoWrap.innerHTML = "<h2 style='color:white;text-align:center;margin-top:20px;padding:20px;'>‚ö†Ô∏è No video link parameter found in the URL.</h2>";
    return;
  }

  const links = decodeURIComponent(raw).split(',').map(x=>x.trim()).filter(Boolean);
  const videos = links.map(getVideoDetails).filter(Boolean);

  // Priority order: Streamwish > Mixdrop > Streamtape
  const priority = ['streamwish','mixdrop','streamtape'];
  let primary = null;
  for(const p of priority){
    primary = videos.find(v=>v.type===p && v.isEmbed);
    if(primary) break;
  }

  // Embed primary video
  if(primary && primary.embedUrl){
    videoWrap.innerHTML = `<iframe src="${primary.embedUrl}" allowfullscreen allow="autoplay; fullscreen; encrypted-media; picture-in-picture; vr"></iframe>`;
    document.getElementById("user-message").innerText = `üé¨ Playing from ${primary.type.toUpperCase()}`;
  } else {
    videoWrap.innerHTML = "<h3 style='color:white;text-align:center;margin-top:20px;padding:20px;'>‚ö†Ô∏è No embeddable video found. Use buttons below.</h3>";
  }

  // Generate buttons (only for available links)
  controls.innerHTML = videos.map(v => `
    <button class="btn" style="background:${v.color};" onclick="window.open('${v.embedUrl || '#'}','_blank')">${v.label}</button>
  `).join('');
}

// ------------------------- Init --------------------------
document.addEventListener('DOMContentLoaded', loadVideo);
</script>
</body>
</html>
