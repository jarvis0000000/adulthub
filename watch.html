<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Now Watching - Dareloom Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* CSS is updated for better aesthetics */
:root {
    --primary: #ff4b91; /* Bright Pink */
    --secondary: #1e90ff; /* Dodger Blue */
    --background: #0d0d0d; /* Darker Background */
    --card-bg: #1a1a1a;
    --text-color: #fff;
    --muted-color: #aaa;
}
body,html{
  margin:0;padding:0;height:100%;
  background:var(--background);color:var(--text-color);
  font-family: 'Poppins', sans-serif; /* Using Poppins */
  display:flex;flex-direction:column;align-items:center;
}
header{
  background:var(--card-bg);padding:15px 0;text-align:center;
  font-size:24px;font-weight:700;width:100%;
  box-shadow:0 3px 8px rgba(0,0,0,0.6);
  z-index: 10;
}

/* Video Player Styling */
#videoWrap {
    width: 100%;
    max-width: 900px;
    margin-top: 15px;
    position: relative;
    padding-top: 56.25%; /* 16:9 ratio */
    height: 0;
    background: #000;
    border-radius: 10px;
    overflow: hidden;
}
iframe{
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  /* 🛑 TOUCH/CLICK FIX: Ensure iframe is fully interactive */
  z-index: 1; 
  touch-action: manipulation;
  pointer-events: auto;
}
.ad-box{
  margin:15px 0;
  width:100%;text-align:center;
}
.btn{
  background:var(--primary);color:#fff;border:none;
  padding:12px 25px;
  border-radius:25px;
  cursor:pointer;font-weight:600;
  margin:10px 8px;
  transition: all 0.3s ease;
  flex-grow: 1;
  max-width: 250px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  font-size: 1rem;
}
.btn:hover {
    background: #c2185b;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}
footer{text-align:center;padding:15px;color:var(--muted-color); font-size: 0.9rem;}

/* Ad Block Warning Styling */
#adblock-warning-overlay {
  display:none; 
  position:fixed; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%; 
  background:rgba(0,0,0,0.95); 
  color:white; 
  text-align:center; 
  z-index:99999; 
  backdrop-filter: blur(5px); 
  justify-content:center; 
  align-items:center; 
  flex-direction:column; 
  padding:20px;
  box-sizing: border-box;
}

/* Main Content Wrapper */
#main-content-wrapper {
    display: none; 
    flex-direction: column;
    align-items: center;
    width: 95%;
    max-width: 900px;
    flex-grow: 1;
}

/* User Message Box */
#user-message {
    background: var(--card-bg);
    color: var(--primary);
    padding: 15px 20px;
    border-radius: 10px;
    width: 100%;
    margin-top: 20px;
    text-align: center;
    font-size: 17px;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

/* Controls Container (Button area) */
#controls-container {
    display: flex;
    justify-content: center;
    width: 100%;
    flex-wrap: wrap;
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 10px;
    background: var(--card-bg);
    border-radius: 10px;
    z-index: 2;
}
</style>
</head>

<body>
<header>🎥 Dareloom Hub</header>

<div id="adblock-warning-overlay" role="alert" aria-live="assertive">
    <h1 style="color:#FFD700; font-size: 2.2rem; margin-top:0;">🚫 Ad Blocker Detected!</h1>
    <p style="font-size:18px; margin-top:20px; max-width:600px;">
        Humein maaf kijiye, hum aapko video nahi dikha sakte jab tak aap apna **Ad Blocker** disable nahi karte.
        Kripya Ad Blocker band karein aur page ko **refresh** karein.
    </p>
</div>

<div id="main-content-wrapper">
    <div id="user-message">
        🎉 **Enjoy watching!** Video loading...
    </div>
    
    <div id="videoWrap"></div>

    <div class="ad-box">
      <script type="text/javascript">
        atOptions = {
          'key' : 'd1be46ed95d3e2db572824c531da5082',
          'format' : 'iframe',
          'height' : 90,
          'width' : 728,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/d1be46ed95d3e2db572824c531da5082/invoke.js"></script>
    </div>

    <div id="controls-container">
    </div>
    
    <div class="ad-box">
      <script type="text/javascript">
        atOptions = {
          'key' : 'd1be46ed95d3e2db572824c531da5082',
          'format' : 'iframe',
          'height' : 90,
          'width' : 728,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/d1be46ed95d3e2db572824c531da5082/invoke.js"></script>
    </div>
</div>

<footer>© Dareloom Hub</footer>

<script>
    // ------------------------- AD POP & BLOCKER LOGIC -------------------------
    const AD_POP = "//bulletinsituatedelectronics.com/24/e4/33/24e43300238cf9b86a05c918e6b00561.js";
    const POP_COOLDOWN_MS = 4000; 
    const POP_DELAY_MS = 500;     
    let lastPop = 0;
    let isAdBlockerActive = false; 

    function openAdsterraPop(){
        if (isAdBlockerActive) return; 
        const now = Date.now();
        if (now - lastPop < POP_COOLDOWN_MS) return;
        lastPop = now;
        setTimeout(() => {
            try{
                const s = document.createElement('script');
                s.src = AD_POP;
                s.async = true;
                document.body.appendChild(s);
                setTimeout(()=>{ try{s.remove();}catch(e){} }, 5000); 
            }catch(e){ console.warn("Ad pop failed", e); }
        }, POP_DELAY_MS);
    }

    function showAdBlockerWarning(){
        isAdBlockerActive = true;
        const warning = document.getElementById('adblock-warning-overlay');
        const content = document.getElementById('main-content-wrapper');
        if (warning) warning.style.display = 'flex';
        if (content) content.style.display = 'none';
    }

    function showContent(){
        isAdBlockerActive = false;
        const warning = document.getElementById('adblock-warning-overlay');
        const content = document.getElementById('main-content-wrapper');
        if (warning) warning.style.display = 'none';
        if (content) content.style.display = 'flex'; 
    }

    function checkAdBlocker(){
        return new Promise(resolve => {
            const dummyAd = document.createElement('div');
            dummyAd.className = 'pub_300x250 pub_dummy_ad ads adblock_detected';
            dummyAd.style.width = '1px';
            dummyAd.style.height = '1px';
            dummyAd.style.position = 'absolute';
            dummyAd.style.left = '-1000px';
            document.body.appendChild(dummyAd);
            setTimeout(() => {
                if (dummyAd.offsetHeight === 0 || dummyAd.offsetParent === null || window.getComputedStyle(dummyAd).getPropertyValue('display') === 'none') {
                    resolve(true); 
                } else {
                    resolve(false); 
                }
                dummyAd.remove();
            }, 300);
        });
    }

    // ------------------------- Helper: Get Video Details (With Priority) -------------------------
    function getVideoDetails(url) {
        url = url.trim();
        const details = { url: url, isEmbed: false, label: 'Open Generic Link', color: '#e91e63', type: 'other', priority: 10 }; 

        if (!url.startsWith('http')) return details; 
        const u = url.toLowerCase();

        // 1. Mixdrop (Highest Priority: 0)
        if (u.includes("mixdrop.co") || u.includes("mixdrop.ag")) {
            details.isEmbed = u.includes('/e/'); 
            details.label = 'Open Mixdrop';
            details.color = '#6a0dad'; 
            details.type = 'mixdrop';
            details.priority = 0; 
            details.embedUrl = url;
        }
        // 2. Streamwish (Second Priority: 1)
        else if (u.includes("streamwish.com") || u.includes("sw.fun")) {
            details.isEmbed = u.includes('/e/'); 
            details.label = 'Open Streamwish';
            details.color = '#ff6347'; 
            details.type = 'streamwish';
            details.priority = 1; 
            details.embedUrl = url; 
        } 
        // 3. Streamtape (Third Priority: 2)
        else if (u.includes("streamtape.com") || u.includes("/v/")){
            let finalUrl = url;
            if (u.includes('/v/')) {
                const m = url.match(/\/v\/([\w-]+)\/?/);
                if (m && m[1]) {
                    finalUrl = `https://streamtape.com/e/${m[1]}/`; 
                }
            }
            details.url = finalUrl; 
            details.isEmbed = true; 
            details.label = 'Open Streamtape';
            details.color = '#0088ff';
            details.type = 'streamtape';
            details.priority = 2;
            details.embedUrl = finalUrl; 
        } 
        
        // 4. Telegram (Button Only: Priority 4)
        else if (u.includes("t.me") || u.includes("telegram.me")) {
            details.isEmbed = false;
            details.label = 'Open Telegram'; 
            details.color = '#2aabee'; 
            details.type = 'telegram';
            details.priority = 4; 
            details.embedUrl = null;
        }
        // 5. Generic (Lowest Priority Embed: 6)
        else if (url.startsWith('http')){
            details.isEmbed = true; 
            details.label = 'Open Generic Player';
            details.color = '#e91e63'; 
            details.type = 'other_embed';
            details.priority = 6;
            details.embedUrl = url;
        }

        return details;
    }

    // ------------------------- Main Load Function --------------------------
    async function loadVideo(){
        // 1. Check Ad Blocker
        const adBlockActive = await checkAdBlocker();
        if (adBlockActive) {
            showAdBlockerWarning();
            return; 
        }
        showContent();
        
        // 2. Pop-under Ad on successful load
        openAdsterraPop();

        // 3. Video URL Parsing and rendering
        const params = new URLSearchParams(window.location.search);
        let raw = params.get("url");
        const videoWrap = document.getElementById("videoWrap");
        const controlsContainer = document.getElementById("controls-container");
        controlsContainer.innerHTML = ''; 

        if(raw){
            const fullLinks = decodeURIComponent(raw).split(',').map(l => l.trim()).filter(Boolean);
            
            let primaryEmbedUrl = '';
            let primaryEmbedLabel = '';
            let highestPriority = Infinity; 
            
            const buttonsHtml = [];
            
            const linkDetails = fullLinks.map(link => getVideoDetails(link));

            // Find the highest priority embeddable link
            for(const details of linkDetails) {
                
                if (details.isEmbed && details.priority < highestPriority && details.embedUrl) {
                    primaryEmbedUrl = details.embedUrl; 
                    primaryEmbedLabel = details.label; 
                    highestPriority = details.priority;
                }
                
                // Generate button HTML for ALL links
                buttonsHtml.push(`
                    <button class="btn" style="background:${details.color};" 
                            onclick="openAdsterraPop(); window.open('${details.url}', '_blank')">
                        ${details.label}
                    </button>
                `);
            }
            
            // 4. Embed the Primary Video
            if (primaryEmbedUrl) {
                // Ensure iframe has necessary 'allow' attributes for full screen and autoplay
                videoWrap.innerHTML = `<iframe src="${primaryEmbedUrl}" allowfullscreen allow="autoplay; fullscreen; encrypted-media; picture-in-picture; vr"></iframe>`;
                document.getElementById('user-message').innerHTML = `🎉 **Enjoy watching!** Video loaded from **${primaryEmbedLabel.replace('Open ', '').replace(' Player', '').replace(' Generic', '')}**.`;
            } else {
                videoWrap.innerHTML = "<h3 style='color:white;text-align:center;margin-top:20px;padding:20px;'>⚠️ No valid embeddable video link found. Use the buttons below to watch.</h3>";
            }

            // 5. Render Buttons
            controlsContainer.innerHTML = buttonsHtml.join('');
            
        } else {
            videoWrap.innerHTML = "<h2 style='color:white;text-align:center;margin-top:20px;padding:20px;'>⚠️ No video link parameter found in the URL.</h2>";
        }
    }

    // 6. Initial Load
    document.addEventListener('DOMContentLoaded', loadVideo);
</script>
</body>
</html>
