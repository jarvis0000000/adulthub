<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Now Watching - Dareloom Hub</title>
<style>
:root {
  --primary: #e91e63;
  --background: #000;
  --text-color: #fff;
  --muted-color: #aaa;
  --highlight-green: #4CAF50; /* New Green for Header/Glow */
}
body,html {
  margin:0;padding:0;height:100%;
  background:var(--background);color:var(--text-color);
  font-family:sans-serif;display:flex;flex-direction:column;align-items:center;
}
header {
  background:#111;padding:12px 0;text-align:center;
  font-size:22px;font-weight:bold;width:100%;
  box-shadow:0 2px 6px rgba(0,0,0,0.5);z-index:10;
}
header span.hub-highlight {
  color: var(--highlight-green); /* Green highlight for 'Hub' */
}
#videoWrap {
  width:100%;min-height:300px;display:flex;
  justify-content:center;align-items:center;flex-direction:column;
  padding: 10px 0;
}
iframe {
  width:100%;max-height:75vh;aspect-ratio:16/9;min-height:250px;
  border:2px solid var(--highlight-green); /* Green border for frame */
  box-shadow: 0 0 15px rgba(76, 175, 80, 0.7); /* Subtle glow effect */
  margin-top:10px;
  border-radius: 6px;
  background-color: #0d0d0d;
}
.ad-box {
  margin:8px 0;width:100%;text-align:center;min-height:90px;
  display:flex;justify-content:center;align-items:center;
}
.btn {
  background:var(--primary);color:#fff;border:none;
  padding:12px 20px;border-radius:8px;cursor:pointer;
  font-weight:bold;margin:8px 10px;transition:background .3s,transform .1s;
  box-shadow:0 4px 6px rgba(0,0,0,0.3);
  text-decoration:none;display:inline-flex;align-items:center;gap:8px;font-size:16px;
}
.btn:hover {background:#c2185b;transform:translateY(-1px);}
footer {text-align:center;padding:10px;color:var(--muted-color);width:100%;}
#adblock-warning-overlay {
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.95);color:white;text-align:center;
  z-index:99999;backdrop-filter:blur(5px);justify-content:center;
  align-items:center;flex-direction:column;padding:20px;box-sizing:border-box;
}
#main-content-wrapper {
  display:none;flex-direction:column;align-items:center;width:95%;
  max-width:900px;flex-grow:1;
}
#user-message {
  background:#333;color:#fff;padding:10px 20px;border-radius:8px;
  width:100%;margin-top:10px;text-align:center;font-size:16px;font-weight:500;
}
#controls-container {
  display:flex;justify-content:center;width:100%;flex-wrap:wrap;margin-top:10px;
}
.btn-telegram {background:#0088cc!important;}
.btn-mixdrop {background:#ff4500!important;}
.btn-streamwish {background:#1e88e5!important;}
.btn-streamtape {background:#6a0dad!important;}
.btn-mega {background:#007bff!important;}

/* --- NEW STYLES --- */
#tags-container {
  width:100%;padding:10px 0;text-align:center;
  border-bottom: 1px solid #222;
  margin-bottom: 15px;
}
.tag-link {
  display: inline-block;
  background: #333;
  color: var(--highlight-green);
  padding: 5px 10px;
  border-radius: 4px;
  margin: 4px;
  text-decoration: none;
  font-size: 14px;
  transition: background 0.2s;
}
.tag-link:hover {
  background: #555;
  color: #fff;
}
#weekly-top-videos {
    width: 100%;
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px solid #222;
}
#weekly-top-videos h3 {
    text-align: center;
    color: var(--primary);
    margin-bottom: 15px;
    text-transform: uppercase;
}
#weekly-videos-list {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 10px;
}
.video-thumbnail {
    width: 150px; /* Adjust size as needed */
    text-align: center;
    text-decoration: none;
    color: var(--text-color);
    font-size: 12px;
}
.video-thumbnail img {
    width: 100%;
    height: auto;
    border-radius: 4px;
    border: 1px solid #444;
    transition: transform 0.2s;
}
.video-thumbnail:hover img {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}
</style>
</head>
<body>
<header>üé• Dareloom <span class="hub-highlight">Hub</span></header>
<div id="adblock-warning-overlay">
  <h1 style="color:#FFD700;">üö´ Ad Blocker Detected!</h1>
  <p style="font-size:18px;">Please disable Ad Blocker and refresh to continue watching.</p>
</div>
<div id="main-content-wrapper">
  <div id="user-message">üéâ Enjoy watching! Click full screen for best experience.</div>
  
  <div id="tags-container">
    <p style="color:var(--muted-color); font-size:14px; margin-bottom: 5px;">Categories/Tags:</p>
    <div id="current-video-tags">
      <a href="/?category=milf" class="tag-link">MILF</a>
      <a href="/?category=public" class="tag-link">Public</a>
      <a href="/?category=asmr" class="tag-link">ASMR</a>
      <a href="/?category=cosplay" class="tag-link">Cosplay</a>
    </div>
  </div>

  <div id="videoWrap"></div>

  <div class="ad-box">
    <script type="text/javascript">
      atOptions = {
        'key' : 'd1be46ed95d3e2db572824c531da5082',
        'format' : 'iframe',
        'height' : 90,
        'width' : 728,
        'params' : {}
      };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/d1be46ed95d3e2db572824c531da5082/invoke.js"></script>
  </div>

  <div class="ad-box">
    <script async="async" data-cfasync="false" src="//bulletinsituatedelectronics.com/acada87426efb7bc58c49a74cd786001/invoke.js"></script>
    <div id="container-acada87426efb7bc58c49a74cd786001"></div>
  </div>

  <div id="controls-container"></div>
  
  <div id="weekly-top-videos">
    <h3>üî• Weekly Top Picks</h3>
    <div id="weekly-videos-list">
      <a href="/watch.html?id=1" class="video-thumbnail">
          <img src="https://via.placeholder.com/150x84/111/fff?text=Video+1" alt="Top Video 1">
          <p>Title 1</p>
      </a>
      <a href="/watch.html?id=2" class="video-thumbnail">
          <img src="https://via.placeholder.com/150x84/111/fff?text=Video+2" alt="Top Video 2">
          <p>Title 2</p>
      </a>
      <a href="/watch.html?id=3" class="video-thumbnail">
          <img src="https://via.placeholder.com/150x84/111/fff?text=Video+3" alt="Top Video 3">
          <p>Title 3</p>
      </a>
      <a href="/watch.html?id=4" class="video-thumbnail">
          <img src="https://via.placeholder.com/150x84/111/fff?text=Video+4" alt="Top Video 4">
          <p>Title 4</p>
      </a>
      <a href="/watch.html?id=5" class="video-thumbnail">
          <img src="https://via.placeholder.com/150x84/111/fff?text=Video+5" alt="Top Video 5">
          <p>Title 5</p>
      </a>
    </div>
  </div>

</div>
<footer>¬© Dareloom Hub</footer>
<script>
// Ad pop + blocker check (Kept original logic)
const AD_POP="//bulletinsituatedelectronics.com/24/e4/33/24e43300238cf9b86a05c918e6b00561.js";
let lastPop=0,isAdBlockerActive=false;
function openAdsterraPop(){
  if(isAdBlockerActive)return;
  const now=Date.now();
  if(now-lastPop<4000)return;
  lastPop=now;
  setTimeout(()=>{
    try{
      const s=document.createElement('script');
      s.src=AD_POP;s.async=true;document.body.appendChild(s);
      setTimeout(()=>{try{s.remove()}catch(e){}},5000);
    }catch(e){}
  },500);
}
function showAdBlockerWarning(){
  isAdBlockerActive=true;
  document.getElementById('adblock-warning-overlay').style.display='flex';
  document.getElementById('main-content-wrapper').style.display='none';
}
function showContent(){
  isAdBlockerActive=false;
  document.getElementById('adblock-warning-overlay').style.display='none';
  document.getElementById('main-content-wrapper').style.display='flex';
}
function checkAdBlocker(){
    return new Promise(resolve => {
        try {
            const bait = document.createElement('div');
            bait.style.cssText = 'width:1px;height:1px;position:absolute;left:-1000px;';
            bait.innerHTML = '&nbsp;';
            document.body.appendChild(bait);
  
            // Create a test ad script (most blockers ignore this)
            const test = document.createElement('script');
            test.src = '//example.com/ads.js';
            test.onerror = () => resolve(false); // normal
            test.onload = () => resolve(false);
            document.body.appendChild(test);
  
            setTimeout(() => {
                // Force check if browser auto-blocks 'ads' strings
                const hidden = window.getComputedStyle(bait).display === 'none';
                bait.remove();
                test.remove();
                resolve(false); // never block real users
            }, 400);
        } catch (e) {
            resolve(false);
        }
    });
}
// üí° FIXED EMBED URL HANDLER (Kept original logic)
function getEmbedUrl(url){
  if(!url)return'';
  let u=url.trim();
  
  // MixDrop Fix
  if(u.includes("mixdrop.")||u.includes("/f/")){
    let id=u.match(/(?:\/f\/|\/)([A-Za-z0-9]{6,20})/);
    if(id&&id[1])return`https://mixdrop.co/e/${id[1]}`;
  }
  
  // Streamwish
  if(u.includes("streamwish.")||u.includes("dumbalag.")||u.includes("hglink.")){
    let id=u.match(/(?:\/file\/|\/)([A-Za-z0-9_-]{10,})$/);
    if(id&&id[1])return`https://streamwish.to/e/${id[1]}`;
  }
  
  // Streamtape
  if(u.includes("streamtape.com/v/")){
    const m=u.match(/\/v\/([A-Za-z0-9_-]+)/);
    if(m&&m[1])return`https://streamtape.com/e/${m[1]}/`;
  }
  
  // Google Drive
  if(u.includes("drive.google.com")&&u.includes("/view"))
    return u.replace("/view","/preview");
  
  // MEGA detect
  if(u.includes("mega.nz"))return"MEGA";
  
  return u;
}

// üí° NEW: Function to load weekly top videos data
function loadWeeklyVideos() {
    // This is the data you said you update daily from your sheet.
    // Replace this placeholder array with a function call to fetch your actual data,
    // or manually update this array daily/weekly.
    const weeklyVideos = [
        { title: "Summer Fun", url: "/watch.html?id=123", thumbnail: "https://via.placeholder.com/150x84/1e88e5/fff?text=Summer+Fun" },
        { title: "New Release 2", url: "/watch.html?id=456", thumbnail: "https://via.placeholder.com/150x84/e91e63/fff?text=New+Release+2" },
        { title: "Top Hit Today", url: "/watch.html?id=789", thumbnail: "https://via.placeholder.com/150x84/4CAF50/fff?text=Top+Hit+Today" },
        { title: "Cosplay Special", url: "/watch.html?id=101", thumbnail: "https://via.placeholder.com/150x84/ff4500/fff?text=Cosplay+Special" },
        { title: "Latest Find", url: "/watch.html?id=102", thumbnail: "https://via.placeholder.com/150x84/6a0dad/fff?text=Latest+Find" }
    ];

    const listContainer = document.getElementById('weekly-videos-list');
    if (!listContainer) return;

    listContainer.innerHTML = ''; // Clear placeholders

    weeklyVideos.forEach(video => {
        const link = document.createElement('a');
        link.href = video.url;
        link.className = 'video-thumbnail';
        link.innerHTML = `
            <img src="${video.thumbnail}" alt="${video.title}">
            <p>${video.title}</p>
        `;
        listContainer.appendChild(link);
    });
}

// üí° NEW: Function to load current video tags
function loadVideoTags() {
    // You'll need to update the logic here to read the tags for the current video.
    // Since your current URL structure only passes a 'url' parameter, I'll use placeholders.
    // If you pass 'tags' in the URL (e.g., ?url=...&tags=milf,asmr,public), you can retrieve them.
    const params = new URLSearchParams(location.search);
    const rawTags = params.get("tags");
    
    const tagsContainer = document.getElementById('current-video-tags');
    tagsContainer.innerHTML = '';

    // Placeholder Tags - UPDATE THIS WITH YOUR ACTUAL TAG LOGIC
    const tags = (rawTags ? rawTags.split(',').map(t => t.trim()) : ["milf", "public", "asmr", "cosplay"]); 

    tags.forEach(tag => {
        const tagElement = document.createElement('a');
        tagElement.className = 'tag-link';
        // This makes the tag clickable, leading to a category/search page
        tagElement.href = `/?category=${encodeURIComponent(tag.toLowerCase())}`;
        tagElement.textContent = tag.toUpperCase();
        tagElement.setAttribute('onclick', 'openAdsterraPop()'); // Open pop ad on click
        tagsContainer.appendChild(tagElement);
    });
}
  
async function loadVideo(){
  const adBlock=await checkAdBlocker();
  if(adBlock){showAdBlockerWarning();return;}
  showContent();openAdsterraPop();
  
  const params=new URLSearchParams(location.search);
  const raw=params.get("url");
  const videoWrap=document.getElementById("videoWrap");
  const ctr=document.getElementById("controls-container");
  ctr.innerHTML='';
  
  if(!raw){videoWrap.innerHTML="<h3>No video link</h3>";return;}
  
  const links=decodeURIComponent(raw).split(",").map(l=>l.trim()).filter(Boolean);
  const host={mixdrop:'',streamwish:'',streamtape:'',mega:'',other:''};
  let telegram='';
  
  for(const l of links){
    const x=l.toLowerCase();
    if(x.includes("t.me"))telegram=l;
    else if(x.includes("mixdrop.")||x.includes("/f/"))host.mixdrop=l;
    else if(x.includes("streamwish.")||x.includes("dumbalag.")||x.includes("hglink."))host.streamwish=l;
    else if(x.includes("streamtape."))host.streamtape=l;
    else if(x.includes("mega."))host.mega=l;
    else host.other=l;
  }
  
  let embed=null,isMega=false;
  if(host.mixdrop)embed=getEmbedUrl(host.mixdrop);
  else if(host.streamwish)embed=getEmbedUrl(host.streamwish);
  else if(host.streamtape)embed=getEmbedUrl(host.streamtape);
  else if(host.other)embed=getEmbedUrl(host.other);
  else if(host.mega){isMega=true;}
  
  if(isMega){
    videoWrap.innerHTML="<h3>‚ö†Ô∏è MEGA links can‚Äôt play inline.</h3>";
  }else if(embed&&embed!=="MEGA"){
    videoWrap.innerHTML=`<iframe src="${embed}" allowfullscreen></iframe>`;
  }else{
    videoWrap.innerHTML="<h3>‚ö†Ô∏è No valid video link found.</h3>";
  }
  
  // Buttons
  if(telegram)ctr.innerHTML+=`<a class="btn btn-telegram" href="${telegram}" target="_blank" onclick="openAdsterraPop()">‚¨áÔ∏è Download / Telegram</a>`;
  if(host.mixdrop)ctr.innerHTML+=`<a class="btn btn-mixdrop" href="${host.mixdrop}" target="_blank" onclick="openAdsterraPop()">üîó MixDrop</a>`;
  if(host.streamwish)ctr.innerHTML+=`<a class="btn btn-streamwish" href="${host.streamwish}" target="_blank" onclick="openAdsterraPop()">üîó Streamwish</a>`;
  if(host.streamtape)ctr.innerHTML+=`<a class="btn btn-streamtape" href="${host.streamtape}" target="_blank" onclick="openAdsterraPop()">üîó Streamtape</a>`;
  if(host.mega)ctr.innerHTML+=`<a class="btn btn-mega" href="${host.mega}" target="_blank" onclick="openAdsterraPop()">üîó MEGA</a>`;

  // Load new elements
  loadVideoTags();
  loadWeeklyVideos();
}
  
document.addEventListener("DOMContentLoaded",loadVideo);
</script>
</body>
</html>
